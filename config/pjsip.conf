; =============================================================================
; Asterisk PJSIP Configuration for Linphone.org SIP Account
; Account: youngho@sip.linphone.org
; Target: AWS EC2 with NAT
; =============================================================================

[global]
type=global
debug=yes

; =============================================================================
; Transport - UDP with NAT settings for AWS EC2
; =============================================================================
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
; NAT Settings - MUST update these for your EC2 instance
external_media_address=13.209.97.212      ; EC2 Public IP
external_signaling_address=13.209.97.212  ; EC2 Public IP
local_net=172.31.0.0/16                   ; AWS VPC CIDR

; =============================================================================
; Linphone.org Registration - Asterisk registers as youngho@sip.linphone.org
; =============================================================================
[linphone]
type=registration
transport=transport-udp
outbound_auth=linphone-auth
server_uri=sip:sip.linphone.org
client_uri=sip:youngho@sip.linphone.org
retry_interval=60
expiration=3600

; =============================================================================
; Authentication for Linphone.org
; =============================================================================
[linphone-auth]
type=auth
auth_type=userpass
username=youngho
; Password will be replaced by deploy.sh using environment variable
password=Dudgh12!

; =============================================================================
; Address of Record
; =============================================================================
[linphone-aor]
type=aor
contact=sip:youngho@sip.linphone.org

; =============================================================================
; Endpoint - How to handle calls from/to Linphone
; =============================================================================
[linphone-endpoint]
type=endpoint
transport=transport-udp
context=from-linphone
disallow=all
allow=ulaw
allow=alaw
outbound_auth=linphone-auth
aors=linphone-aor
from_user=youngho
from_domain=sip.linphone.org
; NAT traversal settings
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

; =============================================================================
; Identify - Match incoming calls from sip.linphone.org to linphone-endpoint
; =============================================================================
[linphone-identify]
type=identify
endpoint=linphone-endpoint
match=sip.linphone.org

; =============================================================================
; Local SIP Clients: agent01 - agent06
; Softphones register to Asterisk directly
; =============================================================================

; --- Agent 01 ---
[agent01]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent01-auth
aors=agent01-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent01-auth]
type=auth
auth_type=userpass
username=agent01
password=Aivle12!

[agent01-aor]
type=aor
max_contacts=1
remove_existing=yes

; --- Agent 02 ---
[agent02]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent02-auth
aors=agent02-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent02-auth]
type=auth
auth_type=userpass
username=agent02
password=Aivle12!

[agent02-aor]
type=aor
max_contacts=1
remove_existing=yes

; --- Agent 03 ---
[agent03]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent03-auth
aors=agent03-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent03-auth]
type=auth
auth_type=userpass
username=agent03
password=Aivle12!

[agent03-aor]
type=aor
max_contacts=1
remove_existing=yes

; --- Agent 04 ---
[agent04]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent04-auth
aors=agent04-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent04-auth]
type=auth
auth_type=userpass
username=agent04
password=Aivle12!

[agent04-aor]
type=aor
max_contacts=1
remove_existing=yes

; --- Agent 05 ---
[agent05]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent05-auth
aors=agent05-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent05-auth]
type=auth
auth_type=userpass
username=agent05
password=Aivle12!

[agent05-aor]
type=aor
max_contacts=1
remove_existing=yes

; --- Agent 06 ---
[agent06]
type=endpoint
context=from-internal
disallow=all
allow=ulaw
allow=alaw
auth=agent06-auth
aors=agent06-aor
direct_media=no
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

[agent06-auth]
type=auth
auth_type=userpass
username=agent06
password=Aivle12!

[agent06-aor]
type=aor
max_contacts=1
remove_existing=yes

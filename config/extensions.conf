; =============================================================================
; Asterisk Dialplan for Linphone SIP Integration
; Routes incoming calls to Stasis application for ExternalMedia handling
; =============================================================================

[general]
static=yes
writeprotect=no

; =============================================================================
; Context: from-linphone
; Handles incoming calls from Linphone.org (youngho@sip.linphone.org)
; =============================================================================
[from-linphone]
; Match any extension - incoming calls from Linphone
exten => _X.,1,NoOp(=== Incoming call from Linphone: ${CALLERID(all)} ===)
 same => n,NoOp(Called number: ${EXTEN})
 same => n,Answer()
 same => n,Wait(1)
 same => n,NoOp(Routing to Stasis app: linphone-handler)
 same => n,Stasis(linphone-handler)
 same => n,NoOp(Call ended, hanging up)
 same => n,Hangup()

; Catch-all for any other patterns (s extension for anonymous)
exten => s,1,NoOp(=== Incoming call to 's' extension ===)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Stasis(linphone-handler)
 same => n,Hangup()

; Handle calls to 'youngho' directly
exten => youngho,1,NoOp(=== Direct call to youngho ===)
 same => n,Answer()
 same => n,Wait(1)
 same => n,Stasis(linphone-handler)
 same => n,Hangup()

; =============================================================================
; Context: from-internal
; For local SIP clients (agent01-06)
; =============================================================================
[from-internal]
; Echo test extension 9999 - bypasses Stasis for RTP debugging
exten => 9999,1,NoOp(=== ECHO TEST from internal ===)
 same => n,Answer()
 same => n,Playback(hello-world)
 same => n,Echo()
 same => n,Hangup()

exten => _X.,1,NoOp(=== Internal call: ${CALLERID(all)} ===)
 same => n,Answer()
 same => n,Stasis(linphone-handler)
 same => n,Hangup()

; =============================================================================
; Context: default (fallback)
; =============================================================================
[default]
exten => _X.,1,NoOp(Default context - unhandled call)
 same => n,Hangup()
